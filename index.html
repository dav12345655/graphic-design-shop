<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Online Graphic Shop</title>
  <style>
    /* Basic layout */
    :root { --accent:#00bcd4; --brand:#111; --ok:#28a745; --danger:#dc3545; }
    body { font-family: "Segoe UI", Roboto, Arial, sans-serif; margin:0; background:#f4f6f8; color:#222; }
    header { background: var(--brand); color:#fff; padding:12px 18px; display:flex; align-items:center; justify-content:space-between; }
    header h1 { margin:0;font-size:20px; }
    .container { max-width:1100px; margin:20px auto; padding:0 16px; }

    /* search */
    #search-input { width:100%; padding:10px 12px; border-radius:8px; border:1px solid #d7dce0; margin-bottom:16px; box-sizing:border-box; }

    /* grid */
    .grid { display:grid; gap:16px; grid-template-columns: repeat(auto-fill, minmax(230px, 1fr)); }
    .product { background:#fff; border-radius:10px; overflow:hidden; box-shadow:0 6px 18px rgba(16,24,40,0.06); transition:transform .12s; cursor:pointer; display:flex; flex-direction:column; }
    .product:hover { transform:translateY(-4px); }
    .product img { width:100%; height:160px; object-fit:cover; display:block; }
    .info { padding:10px; flex:1; display:flex; flex-direction:column; }
    .info h3 { margin:0 0 6px; font-size:15px; color:#111; }
    .info .price { font-weight:700; color:#0b6; margin-bottom:8px; }
    .card-actions { margin-top:auto; }
    .btn { display:inline-block; padding:9px 12px; border-radius:8px; border:0; cursor:pointer; font-weight:600; }
    .btn-primary { background:var(--accent); color:#fff; }
    .btn-ok { background:var(--ok); color:#fff; }
    .btn-ghost { background:#fff; border:1px solid #e6eef5; color:#223; }

    /* cart button (top-right) */
    .cart-btn { background:#ff9800; color:#fff; border:0; padding:8px 12px; border-radius:8px; font-weight:700; cursor:pointer; }

    /* cart modal */
    .modal-backdrop { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:2000; align-items:center; justify-content:center; }
    .modal { background:#fff; width:92%; max-width:480px; border-radius:10px; padding:18px; box-shadow:0 12px 30px rgba(2,6,23,0.2); max-height:88vh; overflow:auto; }
    .modal .close { float:right; font-size:22px; cursor:pointer; color:#666; }
    .cart-item { display:flex; gap:10px; align-items:center; padding:8px 0; border-bottom:1px solid #f0f3f6; }
    .cart-item img { width:64px; height:48px; object-fit:cover; border-radius:6px; }
    .qty-controls button { padding:6px 8px; margin:0 4px; border-radius:6px; border:1px solid #e6eef5; background:#fff; cursor:pointer; }

    /* preview modal */
    .preview-media { width:100%; height:220px; object-fit:contain; border-radius:8px; background:#f7fafc; display:block; margin-bottom:12px; }

    /* floating whatsapp */
    .wa-float { position:fixed; right:18px; bottom:18px; width:60px; height:60px; background:#25D366; color:#fff; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:26px; text-decoration:none; z-index:3000; box-shadow:0 6px 18px rgba(37,211,102,0.18); }

    /* footer */
    footer { margin-top:28px; background:#111; color:#ddd; padding:18px 10px; text-align:center; font-size:14px; border-top:3px solid var(--accent); }
    footer a { color:var(--accent); text-decoration:none; font-weight:600; }

    /* responsiveness */
    @media (max-width:540px) {
      .product img { height:140px; }
      .modal { width:94%; padding:14px; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Online Graphic Shop</h1>
    <div>
      <button id="cart-btn" class="cart-btn">ðŸ›’ Cart (<span id="cart-count">0</span>)</button>
    </div>
  </header>

  <div class="container">
    <input id="search-input" placeholder="Search designs by title or category..." />

    <div id="products-grid" class="grid" aria-live="polite"></div>
  </div>

  <!-- Cart Modal -->
  <div id="cart-modal" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Cart">
      <span id="close-cart" class="close">&times;</span>
      <h2>Your Cart</h2>
      <div id="cart-items"></div>
      <div style="margin-top:12px; display:flex;justify-content:space-between;align-items:center">
        <strong>Total: â‚¦<span id="total-amount">0</span></strong>
        <a id="checkout-link" href="checkout.html" class="btn btn-primary">Proceed to Checkout</a>
      </div>
    </div>
  </div>

  <!-- Product Preview Modal -->
  <div id="preview-modal" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Product preview">
      <span id="close-preview" class="close">&times;</span>
      <img id="preview-image" class="preview-media" src="" alt="Preview" />
      <h3 id="preview-title" style="margin:6px 0 4px;"></h3>
      <div id="preview-category" class="small muted" style="color:#666;margin-bottom:8px;"></div>
      <div style="font-weight:700; margin-bottom:12px;">â‚¦<span id="preview-price">0</span></div>
      <div style="display:flex;gap:8px;justify-content:center">
        <button id="preview-add" class="btn btn-ok">Add to Cart</button>
        <button id="preview-cancel" class="btn btn-ghost">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Floating WhatsApp button -->
  <a class="wa-float" href="https://wa.me/2349121383292" target="_blank" title="Chat on WhatsApp">ðŸ’¬</a>

  <!-- Footer -->
  <footer>
    <div>Designed by <strong>ABblack</strong> Â© <span id="year"></span></div>
    <div style="margin-top:6px;">ðŸ“ž <a href="tel:+2347026865570">07026865570</a> â€” <a href="https://wa.me/2349121383292" target="_blank">Chat on WhatsApp</a></div>
  </footer>

  <script>
  // run after DOM ready
  document.addEventListener('DOMContentLoaded', () => {
    // elements
    const grid = document.getElementById('products-grid');
    const searchInput = document.getElementById('search-input');

    const cartBtn = document.getElementById('cart-btn');
    const cartModal = document.getElementById('cart-modal');
    const closeCart = document.getElementById('close-cart');
    const cartItemsEl = document.getElementById('cart-items');
    const totalAmountEl = document.getElementById('total-amount');
    const cartCountEl = document.getElementById('cart-count');

    const previewModal = document.getElementById('preview-modal');
    const previewImage = document.getElementById('preview-image');
    const previewTitle = document.getElementById('preview-title');
    const previewPrice = document.getElementById('preview-price');
    const previewCategory = document.getElementById('preview-category');
    const previewAddBtn = document.getElementById('preview-add');
    const previewCancelBtn = document.getElementById('preview-cancel');
    const closePreview = document.getElementById('close-preview');

    const STORAGE_PRODUCTS = 'products';
    const STORAGE_CART = 'cart';

    // load stored products (admin exports/imports into this key)
    let products = [];
    try { products = JSON.parse(localStorage.getItem(STORAGE_PRODUCTS)) || []; } catch(e){ products = []; }

    // load cart
    let cart = [];
    try { cart = JSON.parse(localStorage.getItem(STORAGE_CART)) || []; } catch(e){ cart = []; }

    // helper: format currency
    function fmt(n){ return Number(n||0).toLocaleString('en-NG'); }

    // render product grid (list may be provided as filtered)
    function renderProducts(list){
      grid.innerHTML = '';
      const arr = Array.isArray(list) ? list : products;
      if(!arr || arr.length === 0){
        grid.innerHTML = '<div style="padding:28px;text-align:center;color:#667">No products found. Use Admin to add products.</div>';
        return;
      }
      arr.forEach((p, idx) => {
        const card = document.createElement('article');
        card.className = 'product';
        card.dataset.index = idx;
        card.innerHTML = `
          <img loading="lazy" src="${escapeHtml(p.image||'')}" alt="${escapeHtml(p.name||'Design')}">
          <div class="info">
            <h3>${escapeHtml(p.name||'Untitled')}</h3>
            <div class="small" style="color:#6b7280;margin-bottom:6px">${escapeHtml(p.category||'General')}</div>
            <div class="price">â‚¦${fmt(p.price)}</div>
            <div class="card-actions"><button data-action="preview" class="btn btn-primary" style="width:100%; margin-top:8px">Preview</button></div>
          </div>
        `;
        grid.appendChild(card);
      });
    }

    // escape
    function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }

    // CART LOGIC
    function saveCart(){ localStorage.setItem(STORAGE_CART, JSON.stringify(cart)); updateCartUI(); }
    function updateCartUI(){
      // count
      const count = cart.reduce((s,i)=>s+i.qty,0);
      cartCountEl.textContent = count;
      // total & list
      cartItemsEl.innerHTML = '';
      if(cart.length === 0){
        cartItemsEl.innerHTML = '<div style="padding:12px;color:#667">Your cart is empty.</div>';
        totalAmountEl.textContent = '0';
        return;
      }
      let total = 0;
      cart.forEach((it, i) => {
        const row = document.createElement('div');
        row.className = 'cart-item';
        const img = document.createElement('img');
        img.src = it.image || '';
        img.alt = it.name || '';
        const info = document.createElement('div');
        info.style.flex = '1';
        info.innerHTML = `<div style="font-weight:700">${escapeHtml(it.name)}</div><div style="color:#666">â‚¦${fmt(it.price)} â€¢ Qty: ${it.qty}</div>`;
        const controls = document.createElement('div');
        controls.className = 'qty-controls';
        controls.innerHTML = `
          <button data-i="${i}" class="dec">-</button>
          <button data-i="${i}" class="inc">+</button>
          <button data-i="${i}" class="rm" style="margin-left:8px;background:${'#f0f2f4'};border-radius:6px;border:1px solid #e6eef5;padding:6px">Remove</button>
        `;
        row.appendChild(img);
        row.appendChild(info);
        row.appendChild(controls);
        cartItemsEl.appendChild(row);
        total += Number(it.price) * it.qty;
      });
      totalAmountEl.textContent = fmt(total);
    }

    // cart operations
    function addToCart(product, qty = 1){
      if(!product) return;
      const found = cart.find(c => c.id === product.id && c.name === product.name);
      if(found) found.qty += qty;
      else cart.push({ id: product.id || Date.now(), name: product.name, price: Number(product.price || 0), image: product.image || '', qty });
      saveCart();
    }

    function removeCartIndex(i){
      if(i>=0 && i < cart.length) cart.splice(i,1);
      saveCart();
    }

    function changeQty(i, delta){
      if(cart[i]){
        cart[i].qty = Math.max(0, cart[i].qty + delta);
        if(cart[i].qty === 0) removeCartIndex(i);
        else saveCart();
      }
    }

    // handle cart controls via delegation
    cartItemsEl.addEventListener('click', (e) => {
      const btn = e.target.closest('button');
      if(!btn) return;
      const i = Number(btn.dataset.i);
      if(btn.classList.contains('inc')) changeQty(i, +1);
      else if(btn.classList.contains('dec')) changeQty(i, -1);
      else if(btn.classList.contains('rm')) {
        if(confirm('Remove this item?')) removeCartIndex(i);
      }
    });

    // PREVIEW LOGIC
    let currentPreview = null;
    function openPreview(product){
      currentPreview = product;
      previewImage.src = product.image || '';
      previewTitle.textContent = product.name || 'Untitled';
      previewCategory.textContent = product.category || '';
      previewPrice.textContent = fmt(product.price);
      previewModal.style.display = 'flex'; previewModal.setAttribute('aria-hidden','false');
    }
    function closePreviewModal(){ previewModal.style.display = 'none'; previewModal.setAttribute('aria-hidden','true'); currentPreview = null; }

    // attach preview/add handlers
    previewAddBtn.addEventListener('click', () => {
      if(currentPreview){ addToCart(currentPreview, 1); alert(`${currentPreview.name} added to cart`); closePreviewModal(); }
    });
    previewCancelBtn.addEventListener('click', closePreviewModal);
    closePreview.addEventListener('click', closePreviewModal);
    previewModal.addEventListener('click', (e) => { if(e.target === previewModal) closePreviewModal(); });

    // Open/close cart modal
    cartBtn.addEventListener('click', () => {
      updateCartUI();
      cartModal.style.display = 'flex';
      cartModal.setAttribute('aria-hidden','false');
    });
    closeCart.addEventListener('click', () => { cartModal.style.display='none'; cartModal.setAttribute('aria-hidden','true'); });
    cartModal.addEventListener('click', (e) => { if(e.target === cartModal) { cartModal.style.display='none'; cartModal.setAttribute('aria-hidden','true'); } });

    // product click delegation (open preview)
    grid.addEventListener('click', (e) => {
      const card = e.target.closest('.product');
      if(!card) return;
      const idx = Number(card.dataset.index);
      const product = (products[idx] !== undefined) ? products[idx] : null;
      if(product) openPreview(product);
    });

    // search/filter
    searchInput.addEventListener('input', () => {
      const q = searchInput.value.trim().toLowerCase();
      if(!q) { renderProducts(products); return; }
      const filtered = products.filter(p => (p.name||'').toLowerCase().includes(q) || (p.category||'').toLowerCase().includes(q));
      renderProducts(filtered);
    });

    // initialize UI
    document.getElementById('year').textContent = new Date().getFullYear ? new Date().getFullYear() : new Date().getFullYear();
    renderProducts(products);
    updateCartUI();

    // expose for debug in console if needed
    window.__OGSHOP = { products, cart, addToCart, renderProducts };
  });
  </script>
</body>
</html>
