<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Checkout ‚Äî Online Graphic Shop</title>
<style>
  body{font-family:Inter,system-ui,Arial;background:#f4f6fb;color:#0f172a;margin:0}
  header{background:#111;color:#fff;padding:14px 18px;text-align:center}
  main{max-width:900px;margin:24px auto;padding:18px}
  .card{background:#fff;border-radius:12px;padding:14px;box-shadow:0 8px 24px rgba(16,24,40,0.06)}
  .item{display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-bottom:1px dashed #eee}
  .item img{width:80px;height:60px;object-fit:cover;border-radius:6px;margin-right:10px}
  .total{font-weight:900;font-size:20px;margin-top:12px}
  .form{margin-top:12px;display:grid;gap:8px}
  input,textarea{padding:10px;border-radius:8px;border:1px solid #e6e9ef}
  .btn{padding:10px;border-radius:8px;border:0;background:#111;color:#fff;cursor:pointer;font-weight:700}
  .note{background:#fff8f6;border:1px solid #ffdede;padding:10px;border-radius:8px;margin-top:12px}
  /* Modals (reuse similar style) */
  .modal-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);align-items:center;justify-content:center;z-index:10000}
  .modal-box{background:#fff;border-radius:12px;padding:20px;max-width:420px;width:92%;text-align:center;box-shadow:0 8px 24px rgba(0,0,0,0.18)}
  .spinner{border:4px solid #f3f3f3;border-top:4px solid #111;border-radius:50%;width:45px;height:45px;animation:spin 1s linear infinite;margin:0 auto 12px}
  @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
  .success h2{color:#16a34a}.error h2{color:#e11d48}
  .whatsapp-float{position:fixed;bottom:20px;right:20px;background:#25d366;color:white;border-radius:50%;width:60px;height:60px;display:flex;align-items:center;justify-content:center;font-size:28px;z-index:1000;text-decoration:none}
</style>
</head>

<!-- Floating WhatsApp -->
<a class="whatsapp-float" href="https://wa.me/2349121383292" target="_blank">üí¨</a>

<body>
<header><h1>Checkout ‚Äî Online Graphic Shop</h1></header>
<main>
  <div class="card">
    <h3>Order Summary</h3>
    <div id="items"></div>
    <div class="total">Total: ‚Ç¶<span id="total">0</span></div>

    <h4 style="margin-top:16px">Delivery / Contact</h4>
    <div class="form">
      <input id="name" placeholder="Full name" />
      <input id="phone" placeholder="Phone or Email" />
      <textarea id="address" rows="3" placeholder="Address (optional)"></textarea>
    </div>

    <div class="note">
      <strong>Payment details</strong><br>
      Name: <strong>Joy Gift</strong><br>
      Account: <strong>9121383292</strong><br>
      Bank: <strong>Opay</strong><br>
      After payment, click "I have paid" and enter your transaction ID (required).
    </div>

    <div style="display:flex;gap:10px;margin-top:12px">
      <button id="pay" class="btn" style="flex:1">I have paid</button>
      <button id="back" class="btn" style="background:#e6e6e6;color:#111">Back to shop</button>
    </div>
  </div>
</main>

<!-- Success Modal -->
<div id="successModal" class="modal-overlay">
  <div class="modal-box success">
    <h2>‚úÖ Payment Verified</h2>
    <p>Your payment was verified and your order was saved. We'll contact you shortly.</p>
    <button id="okBtn">Back to Home</button>
  </div>
</div>

<!-- Error Modal -->
<div id="errorModal" class="modal-overlay">
  <div class="modal-box error">
    <h2>‚ö†Ô∏è Error</h2>
    <p id="errorText">Something went wrong.</p>
    <button id="closeError">OK</button>
  </div>
</div>

<!-- Verifying Modal -->
<div id="verifyModal" class="modal-overlay">
  <div class="modal-box">
    <div class="spinner"></div>
    <div style="font-weight:700;margin-bottom:8px">Verifying transaction...</div>
    <div style="color:#666">We are checking the provided transaction ID.</div>
  </div>
</div>

<script>
/*
  Checkout behavior:
  - Uses 'cart' key in localStorage (array of product objects).
  - Transaction ID is required and validated locally (alphanumeric, min 8, must contain letters+digits).
  - NOTE: Real verification against Opay/bank requires a server-side API. Here we validate format and simulate verification.
*/

function showModal(id){ document.getElementById(id).style.display = 'flex'; }
function hideModal(id){ document.getElementById(id).style.display = 'none'; }

function showError(text){
  document.getElementById('errorText').textContent = text;
  showModal('errorModal');
}
document.getElementById('closeError').addEventListener('click', ()=> hideModal('errorModal'));

document.getElementById('back').addEventListener('click', ()=> location.href='index.html');

let cart = JSON.parse(localStorage.getItem('cart') || '[]') || [];
function buildItems(){
  const itemsDiv = document.getElementById('items');
  itemsDiv.innerHTML = '';
  let total = 0;
  if(!cart.length){
    itemsDiv.innerHTML = '<p>Your cart is empty. <a href="index.html">Continue shopping</a></p>';
    document.getElementById('total').textContent = '0';
    return;
  }
  cart.forEach(p=>{
    total += Number(p.price || 0);
    const row = document.createElement('div');
    row.className = 'item';
    row.innerHTML = `<div style="display:flex;align-items:center">
      <img src="${p.image||''}" alt="">
      <div>
        <div style="font-weight:700">${p.name||'Product'}</div>
        <div style="color:#667085;font-size:13px">‚Ç¶${new Intl.NumberFormat('en-NG').format(p.price||0)}</div>
      </div>
    </div>
    <div style="font-weight:800">‚Ç¶${new Intl.NumberFormat('en-NG').format((p.price||0))}</div>`;
    itemsDiv.appendChild(row);
  });
  document.getElementById('total').textContent = new Intl.NumberFormat('en-NG').format(total);
}
buildItems();

// Validation & verification
function txIsValidFormat(tx){
  if(!tx) return false;
  if(!/^[A-Za-z0-9]{8,}$/.test(tx)) return false; // at least 8 alnum
  // must contain at least one letter and one digit
  if(!/[A-Za-z]/.test(tx) || !/[0-9]/.test(tx)) return false;
  return true;
}

document.getElementById('pay').addEventListener('click', ()=>{
  const name = document.getElementById('name').value.trim();
  const phone = document.getElementById('phone').value.trim();
  if(!name || !phone){
    showError('Please enter your full name and phone/email.');
    return;
  }

  // ask for transaction id (required)
  const tx = prompt('Enter your transaction ID (required) to confirm payment:');
  if(!tx){ showError('Transaction ID is required. Please enter it to confirm payment.'); return; }
  if(!txIsValidFormat(tx)){
    showError('Invalid transaction ID. It must be at least 8 characters, alphanumeric, and include both letters and numbers.');
    return;
  }

  // show verifying spinner
  showModal('verifyModal');

  // simulate remote verification (2s) - replace with real server check when available
  setTimeout(()=>{
    hideModal('verifyModal');

    // simulated verification logic:
    // here we accept tx that pass txIsValidFormat ‚Äî you can replace this by server API call
    const verified = true; // simulation: format-validated tx considered verified
    if(!verified){
      showError('Transaction not found or not verified. Please contact support.');
      return;
    }

    // Save order locally (orders array)
    const orders = JSON.parse(localStorage.getItem('orders') || '[]');
    const order = {
      id: 'ORD' + Date.now(),
      customer: { name, phone },
      items: cart,
      tx,
      createdAt: new Date().toISOString()
    };
    orders.unshift(order);
    localStorage.setItem('orders', JSON.stringify(orders));

    // Clear cart immediately and update UI
    localStorage.removeItem('cart');
    cart = [];
    buildItems();

    // show success modal
    showModal('successModal');
  }, 2000);
});

document.getElementById('okBtn').addEventListener('click', ()=> {
  hideModal('successModal');
  location.href = 'index.html';
});
</script>
</body>
</html>
