<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Checkout ‚Äî Online Graphic Shop</title>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
  :root {
    --bg1:#4f46e5; --bg2:#7c3aed;
    --card:#ffffffcc; --muted:#6b7280;
    --accent:#06b6d4; --success:#16a34a; --danger:#ef4444;
  }
  html,body {height:100%;margin:0}
  body {
    font-family: Inter, system-ui, Segoe UI, Arial, sans-serif;
    background: linear-gradient(135deg,var(--bg1),var(--bg2));
    color: #0f172a;
    display: flex;align-items: flex-start;justify-content: center;
    padding: 28px 12px;box-sizing: border-box;min-height:100vh;
  }
  .container {width:100%;max-width:980px;margin:18px auto;}
  header {display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:18px;color:#fff;position:relative;}
  header h1 {margin:0;font-size:20px}
  header p {margin:0;opacity:0.9;font-size:13px}
  .menu {
    position: absolute;
    right: 0;
  }
  .menu-btn {
    background: transparent;
    border: none;
    color: white;
    font-size: 22px;
    cursor: pointer;
  }
  .dropdown {
    display: none;
    position: absolute;
    top: 32px;
    right: 0;
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    overflow: hidden;
  }
  .dropdown a {
    display: block;
    padding: 10px 16px;
    color: #0f172a;
    text-decoration: none;
    font-size: 14px;
  }
  .dropdown a:hover {background: #f1f5f9;}
  .card {background: var(--card);border-radius:14px;padding:18px;box-shadow:0 10px 30px rgba(2,6,23,0.25);backdrop-filter:blur(6px);}
  .grid {display:grid;grid-template-columns:1fr 360px;gap:18px;}
  @media(max-width:880px){.grid{grid-template-columns:1fr}}
  .left,.right{padding:8px}
  .items-list{background:#fff;border-radius:10px;padding:12px;max-height:420px;overflow:auto}
  .item{display:flex;gap:12px;align-items:center;padding:10px 6px;border-bottom:1px solid #f1f5f9;}
  .item img{width:78px;height:56px;object-fit:cover;border-radius:8px}
  .item .meta{flex:1}
  .item .meta b{display:block}
  .item .meta small{color:var(--muted);display:block;margin-top:6px;font-size:13px}
  .item .price{font-weight:800}
  .total-row{display:flex;justify-content:space-between;align-items:center;padding:14px 6px;font-weight:800;font-size:18px}
  .form{margin-top:12px;display:grid;gap:10px}
  .form input{width:100%;padding:10px;border-radius:10px;border:1px solid #e6edf4;font-size:15px;}
  .btn{display:inline-block;padding:12px 14px;border-radius:10px;border:0;color:white;font-weight:800;cursor:pointer;
       background:linear-gradient(90deg,#06b6d4,#06b6d4);}
  .btn-primary{background:linear-gradient(90deg,#0ea5e9,#7c3aed)}
  .btn-ghost{background:transparent;border:1px solid rgba(15,23,42,0.06);color:#0f172a}
  .note{margin-top:12px;padding:12px;border-radius:10px;background:rgba(255,255,255,0.8);font-size:14px;color:#334155;}
  footer{margin-top:16px;color:#fff;text-align:center;font-size:13px}
  .whatsapp{position:fixed;right:18px;bottom:18px;width:64px;height:64px;border-radius:50%;
    background:#25D366;color:#fff;display:flex;align-items:center;justify-content:center;font-size:28px;
    z-index:9999;box-shadow:0 10px 30px rgba(2,6,23,0.25);text-decoration:none;}
  #wallet-bar{
    position:fixed;top:12px;left:12px;background:#fff;
    padding:8px 14px;border-radius:25px;box-shadow:0 4px 10px rgba(0,0,0,0.15);
    display:flex;align-items:center;gap:10px;font-weight:700;color:#0f172a;z-index:999;
  }
  #deposit-btn{
    background:linear-gradient(90deg,#0ea5e9,#7c3aed);
    border:none;color:#fff;padding:6px 10px;border-radius:12px;font-size:13px;cursor:pointer;
  }
</style>
</head>

<body>
  <div class="container">
    <header>
      <div>
        <h1>Checkout ‚Äî Online Graphic Shop</h1>
        <p>Confirm details to complete your order</p>
      </div>
      <div class="menu">
        <button class="menu-btn">‚ãÆ</button>
        <div class="dropdown" id="dropdown-menu">
          <a href="index.html">üè† Home</a>
          <a href="cart.html">üõí View Cart</a>
          <a href="#" id="logout">üö™ Logout</a>
        </div>
      </div>
    </header>

    <div class="card">
      <div class="grid">
        <div class="left">
          <div class="items-list" id="items-list"></div>
          <div class="total-row">
            <div>Total</div>
            <div>‚Ç¶<span id="total-amount">0</span></div>
          </div>

          <div class="form">
            <input id="cust-name" placeholder="Full name" />
            <input id="cust-phone" placeholder="Phone or email" />
          </div>

          <div class="note">
            <strong>Note:</strong> Ensure you have enough wallet balance to cover your total before clicking ‚ÄúPay Now.‚Äù
          </div>
        </div>

        <div class="right">
          <div style="background:linear-gradient(180deg,#ffffffcc,#ffffffbb);padding:14px;border-radius:10px">
            <h3 style="margin:0 0 8px">Payment</h3>
            <p style="color:var(--muted);margin:0 0 12px">
              No bank details needed. Your payment will be deducted directly from your wallet.
            </p>

            <div style="display:flex;gap:8px;margin-top:14px">
              <button id="pay-btn" class="btn btn-primary" style="flex:1">Pay Now</button>
              <button id="back-shop" class="btn btn-ghost" style="flex:1">Back to Shop</button>
            </div>

            <div style="margin-top:12px;text-align:center">
              <small style="color:var(--muted)">Need help? Chat with us on WhatsApp.</small>
            </div>
          </div>

          <div style="margin-top:12px;background:rgba(255,255,255,0.85);padding:12px;border-radius:10px;text-align:center">
            <strong style="font-size:14px">Order Summary</strong>
            <div style="margin-top:8px;color:var(--muted);font-size:14px" id="summary-count">0 items</div>
          </div>
        </div>
      </div>
    </div>

    <footer>
      Designed by <strong>ABblack</strong> ‚Ä¢ üìû 
      <a href="tel:+2347026865570" style="color:#c7f9ff;text-decoration:none">07026865570</a>
    </footer>
  </div>

  <a class="whatsapp" href="https://wa.me/2349121383292" target="_blank">üí¨</a>

<script>
// ===== MENU FUNCTIONALITY =====
const menuBtn=document.querySelector('.menu-btn');
const dropdown=document.getElementById('dropdown-menu');
menuBtn.addEventListener('click',()=>dropdown.style.display=dropdown.style.display==='block'?'none':'block');
window.addEventListener('click',e=>{
  if(!menuBtn.contains(e.target)&&!dropdown.contains(e.target)) dropdown.style.display='none';
});
document.getElementById('logout').addEventListener('click',()=>{
  localStorage.removeItem('loggedInUser');
  Swal.fire({icon:'info',title:'Logged Out',text:'You have been logged out.'})
  .then(()=>window.location.href='login.html');
});

// ===== USER SESSION + WALLET =====
const userEmail=localStorage.getItem('loggedInUser');
if(!userEmail){
  Swal.fire({icon:'warning',title:'Login Required',text:'Please login to continue.',confirmButtonText:'Go to Login'})
  .then(()=>window.location.href='login.html');
}

function getWallets(){return JSON.parse(localStorage.getItem('wallets')||'{}');}
function getWalletBalance(){
  const wallets=getWallets();
  return parseFloat(wallets[userEmail]||0);
}
function setWalletBalance(amount){
  const wallets=getWallets();
  wallets[userEmail]=amount;
  localStorage.setItem('wallets',JSON.stringify(wallets));
}

// WALLET BAR
const walletBar=document.createElement('div');
walletBar.id='wallet-bar';
walletBar.innerHTML=`üí∞ Wallet: ‚Ç¶<span id="wallet-balance">${getWalletBalance().toLocaleString()}</span>
<button id="deposit-btn">Deposit</button>`;
document.body.appendChild(walletBar);

document.getElementById('deposit-btn').addEventListener('click',async()=>{
  const {value:amount}=await Swal.fire({
    title:'Deposit Funds',
    input:'number',
    inputLabel:'Enter amount to deposit (‚Ç¶)',
    inputAttributes:{min:1},
    showCancelButton:true,
    confirmButtonText:'Deposit',
    confirmButtonColor:'#4f46e5'
  });
  if(!amount||amount<=0)return;
  if(amount>1000000)return Swal.fire({icon:'error',title:'Deposit Limit',text:'Maximum deposit is ‚Ç¶1,000,000.'});

  Swal.fire({title:'Processing deposit...',allowOutsideClick:false,didOpen:()=>Swal.showLoading()});
  await new Promise(r=>setTimeout(r,2000));
  Swal.close();

  const newBal=getWalletBalance()+parseFloat(amount);
  setWalletBalance(newBal);
  document.getElementById('wallet-balance').textContent=newBal.toLocaleString();
  Swal.fire({icon:'success',title:'Deposit successful!',text:'Your wallet has been credited.'});
});
</script>

<script>
// ===== CART + PAYMENT LOGIC =====
(function(){
  const itemsList=document.getElementById('items-list');
  const totalAmountEl=document.getElementById('total-amount');
  const summaryCount=document.getElementById('summary-count');
  const payBtn=document.getElementById('pay-btn');
  const backShop=document.getElementById('back-shop');
  const nameInput=document.getElementById('cust-name');
  const phoneInput=document.getElementById('cust-phone');
  let cart=[];
  try{cart=JSON.parse(localStorage.getItem('cart')||'[]');}catch(e){cart=[];}

  function renderCart(){
    itemsList.innerHTML='';
    if(!cart.length){
      itemsList.innerHTML='<p style="color:#475569">Your cart is empty. <a href="products.html">Go back to shop</a></p>';
      totalAmountEl.textContent='0'; summaryCount.textContent='0 items'; return;
    }
    let total=0;
    cart.forEach(p=>{
      total+=Number(p.price||0);
      const row=document.createElement('div');
      row.className='item';
      row.innerHTML=`<img src="${p.image}" alt="${p.name}">
        <div class="meta"><b>${p.name}</b><small>${p.desc||''}</small></div>
        <div class="price">‚Ç¶${Number(p.price).toLocaleString()}</div>`;
      itemsList.appendChild(row);
    });
    totalAmountEl.textContent=total.toLocaleString();
    summaryCount.textContent=`${cart.length} item${cart.length>1?'s':''}`;
  }

  payBtn.addEventListener('click',async()=>{
    const name=nameInput.value.trim(),phone=phoneInput.value.trim();
    const total=parseFloat(totalAmountEl.textContent.replace(/,/g,''))||0;
    const current=getWalletBalance();

    if(!cart.length)return Swal.fire({icon:'error',title:'Empty Cart',text:'Add items before checking out.'});
    if(!name||!phone)return Swal.fire({icon:'error',title:'Missing Info',text:'Please enter your full name and contact.'});
    if(current<total)return Swal.fire({icon:'error',title:'Insufficient Wallet',text:'Deposit more funds before checkout.'});

    Swal.fire({title:'Processing payment...',allowOutsideClick:false,didOpen:()=>Swal.showLoading()});
    await new Promise(r=>setTimeout(r,1500)); Swal.close();

    const newBal=current-total;
    setWalletBalance(newBal);
    document.getElementById('wallet-balance').textContent=newBal.toLocaleString();
    localStorage.setItem('cart','[]'); // clear cart
    Swal.fire({icon:'success',title:'Payment Successful',text:'Your order has been placed successfully!'})
    .then(()=>window.location.href='products.html');
  });

  backShop.addEventListener('click',()=>window.location.href='products.html');
  renderCart();
})();
</script>
</body>
</html>
